import { pentestingdetails } from '../constants'
import Button from './Button'
import Section from './Section'
import Heading from './Heading'
import Pricing from './Pricing'
import { Link } from 'react-router-dom'
import gsap from "gsap";
import { useGSAP } from "@gsap/react";
import { useRef } from 'react'
import { ScrollTrigger } from "gsap/ScrollTrigger";

gsap.registerPlugin(ScrollTrigger);

const Pentesting = () => {

  const titleRef = useRef(null);
  const title2Ref = useRef(null);
  const textRef = useRef(null);
  const buttonRef = useRef(null);
  const backRef = useRef(null);
  const tagRef = useRef(null);
  const cardRefs = useRef([]);
  const titleRefs = useRef([]);
  const textRefs = useRef([]);

  const addCardRef = (el) => el && !cardRefs.current.includes(el) && cardRefs.current.push(el);
  const addTitleRef = (el) => el && titleRefs.current.push(el);
  const addTextRef = (el) => el && textRefs.current.push(el);

  useGSAP(() => {
    
    gsap.from([backRef.current, tagRef.current, titleRef.current, textRef.current,buttonRef.current, title2Ref.current], {
      opacity: 0,
      y: 30,
      duration: 1,
      ease: "power3.out",
      stagger: {
        amount: 1,  
        from: "start", 
      }
    });

    cardRefs.current.forEach((card, i) => {
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: card,
          start: "top 85%",
        },
      });

      tl.from(card, {
        opacity: 0,
        rotateY: 90,       
        transformOrigin: "left center",
        duration: 1,
        ease: "power3.out",
        delay: i * 0.25,     
      });
   
      tl.from(titleRefs.current[i], {
          opacity: 0,
          y: 20,
          duration: 0.5,
        }, "-=0.4");

        tl.from(textRefs.current[i], {
          opacity: 0,
          y: 20,
          duration: 0.5,
        }, "-=0.35");
      });
  }, []);

  return (
    <Section 
    className="pt-[10rem] -mt-[5.25rem]"
    crosses
    crossesOffset="lg:translate-y-[5.25rem]"
    customPaddings
    id="pentesting">

        <p ref={backRef} className="body-2 text-n-3 mx-[6rem] mb-[2rem]">
            <Link to="/services" className="text-n-1 hover:text-color-1 transition">
                 <span className="text-xl leading-none px-3">‚Üê</span>
                Back to Services
            </Link>
        </p>
      <div className="container lg:flex">
        <div >
            <p ref={tagRef} className="body-2 my-2 pb-2 text-n-4">Security First</p>
            <h2 ref={titleRef} className="max-w-[25rem] h2 mb-4 md:mb-8">
                Penetration Testing
            </h2>

            <p ref={textRef} className="body-1 mb-[2rem] mt-[2rem]">
                Comprehensive security assessments to identify vulnerabilities before malicious actors do. 
                We help you stay ahead of threats.
            </p>

            <Button ref={buttonRef} white href="/contact">Get a Quote</Button>
        </div>
      </div>

      <div className="container relative z-2">
        <Heading
          ref={title2Ref}
          className="mt-[5rem] md:max-w-md lg:max-w-2xl"
          title="Our process"
        />

        <div className="flex flex-wrap gap-10 mb-10">
          {pentestingdetails.map((item) => (
            <div
              ref={addCardRef}
              className="block relative p-0.5 bg-no-repeat bg-[length:100%_100%] md:max-w-[24rem]"
              style={{
                backgroundImage: `url(${item.backgroundUrl})`,
              }}
              key={item.id}
            >
              <div className="relative z-2 flex flex-col justify-center min-h-[22rem] p-[2.4rem] pointer-events-none">
                
                <div className="flex items-center mt-auto">
                  <p className="font-code text-[1.5rem] font-bold text-n-1 mb-[1rem]">{item.id}</p>
                </div>
                <h4 ref={addTitleRef} className="h4 mb-5 ">{item.title}</h4>
                <p ref={addTextRef} className="body-2 mt-6 mb-6 text-n-3">{item.text}</p>
              </div>
            </div>
          ))}
        </div>
      </div>
      <Pricing />
    </Section>
  )
}

export default Pentesting